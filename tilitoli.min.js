const root=document.documentElement,tiles=document.querySelectorAll(".tile"),tile_board=document.querySelector("#tiles"),hud=document.querySelector("#hud"),hud_steps=document.querySelector("#steps span"),hud_time=document.querySelector("#time span"),goodjob=document.querySelector("#goodjob"),anim=document.querySelector("#anim"),diffs=document.querySelectorAll("#diff input");let map=Array(25).fill().map((n,i)=>i);const check=[...map];let drag,game=!1,col,row,dir,xorigin,yorigin,steps,time,animdur=300,rotatedeg=0;function drawtiles(){let c=0;for(let y=1;y<6;y++){for(let x=1;x<6;x++)tiles[x+7*y].setAttribute("id","tile-"+map[c]),c++;tiles[y].setAttribute("id","tile-"+map[y-1+20]),tiles[y+42].setAttribute("id","tile-"+map[y-1]),tiles[7*y].setAttribute("id","tile-"+map[5*y-1]),tiles[7*y+6].setAttribute("id","tile-"+map[5*(y-1)])}hud_steps.innerHTML=steps}function inctime(){game&&(time++,hud_time.innerHTML=Math.floor(time/60).toString().padStart(2,"0")+":"+(time%60).toString().padStart(2,"0"),setTimeout(()=>{requestAnimationFrame(inctime)},1e3))}function removeclass(){tiles.forEach(t=>{t.className=""}),map.toString()==check.toString()&&!0===game&&(game=!1,goodjob.className="show")}function shift(dir,roc){if(dir%2==0){let temp=map.filter((e,i)=>i%5==roc);if(0==dir){temp.push(temp.shift());for(let q=0;q<7;q++)tiles[roc+1+7*q].className="up"}else{temp.unshift(temp.pop());for(let q=0;q<7;q++)tiles[roc+1+7*q].className="down"}map=map.map((function(e,i){return i%5==roc?temp[(i-roc)/5]:e}))}else{let temp=map.slice(5*roc,5*roc+5);if(1==dir){temp.unshift(temp.pop());for(let q=0;q<7;q++)tiles[7*(roc+1)+q].className="right"}else{temp.push(temp.shift());for(let q=0;q<7;q++)tiles[7*(roc+1)+q].className="left"}map.splice(5*roc,5,...temp)}setTimeout(()=>{requestAnimationFrame(removeclass)},animdur)}function inc_rotatedeg(){root.style.setProperty("--rotate-deg",rotatedeg+"deg"),rotatedeg++,rotatedeg=rotatedeg>360?1:rotatedeg,setTimeout(()=>{requestAnimationFrame(inc_rotatedeg)},20)}goodjob.onclick=()=>{shuffle.disabled=!1,goodjob.className="",hud.className=""},drawtiles(),tiles.forEach((t,i)=>{t.onpointerdown=e=>{col=i%7,row=Math.floor(i/7),xorigin=e.clientX,yorigin=e.clientY,col>0&&col<6&&row>0&&row<6&&(drag=!0),this.onpointerup=e=>{drag&&(drag=!1,Math.abs(e.clientY-yorigin)>Math.abs(e.clientX-xorigin)?(e.clientY-yorigin<-20&&shift(0,col-1),e.clientY-yorigin>20&&shift(2,col-1)):(e.clientX-xorigin<-20&&shift(3,row-1),e.clientX-xorigin>20&&shift(1,row-1)),steps++,drawtiles())}}}),shuffle.onclick=e=>{if(!1===game)for(let q=0;q<666;q++)shift(0|4*Math.random(),0|5*Math.random());shuffle.disabled=!0,hud.className="show",game=!0,steps=0,time=0,inctime(),drawtiles()},anim.onchange=e=>{animdur=e.target.checked?300:0},diffs.forEach(e=>{e.onchange=e=>{tile_board.className=e.target.id}}),animdur=anim.checked?300:0,tile_board.className=document.querySelector("[name=diff]:checked").id,requestAnimationFrame(inc_rotatedeg);